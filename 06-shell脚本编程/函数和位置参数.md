# 6.5 函数和位置参数

## 1. bash编程函数：
### 1.1 定义语法：
```
# 方式一
function F_NAME {
  函数体
}

# 方式二
F_NAME() {
  函数体
}
```

### 1.2 调用与返回值
- 调用：使用函数名，函数名出现的地方，会被自动替换为函数；
- 函数的返回值：
    - 函数的执行结果返回值：代码的输出
        - 函数中的打印语句：echo, print
        - 函数中调用的系统命令执行后返回的结果
    - 执行状态返回值：
        - 函数体中最后一次执行的命令状态结果
        - 自定函数执行状态的返回值：return #

### 1.3 函数可以接受参数：
- 在函数体中调用函数参数的方式同脚本中调用脚本参数的方式：位置参数
      - \$1, \$2, ...
      - \$\#, \$\*, \$\@

## 2. 函数四使用示例
### 2.1 示例：服务脚本示例
```
#!/bin/bash
#
# chkconfig: 2345 67 34
#
srvName=$(basename $0)

lockFile=/var/lock/subsys/$srvName

start() {
    if [ -f $lockFile ];then
  echo "$srvName is already running."
  return 1
    else
  touch $lockFile
  [ $? -eq 0 ] && echo "Starting $srvName OK."
  return 0
     fi
}

stop() {
    if [ -f $lockFile ];then
  rm -f $lockFile &> /dev/null
  [ $? -eq 0 ] && echo "Stop $srvName OK" && return 0
    else
  echo "$srvName is not started."
  return 1
    fi
}

status() {
    if [ -f $lockFile ]; then
  echo "$srvName is running."
    else
  echo "$srvName is stopped."
    fi
    return 0
}

usage() {
     echo "Usage: $srvName {start|stop|restart|status}"
     return 0
}

case $1 in
start)
  start
  ;;
stop)
  stop ;;
restart)
  stop
  start ;;
status)
  status ;;
*)
  usage
  exit 1 ;;
esac
```

### 2.2 功能脚本
```
# 练习：写一个脚本，完成如下功能(使用函数)：
# 1、提示用户输入一个可执行命令；
# 2、获取这个命令所依赖的所有库文件(使用ldd命令)；
# 3、复制命令至/mnt/sysroot/对应的目录中
#   解释：假设，如果复制的是cat命令，其可执行程序的路径是/bin/cat，那么就要将/bin/cat复制到/mnt/sysroot/bin/目录中，如果复制的是useradd命令，而useradd的可执行文件路径为/usr/sbin/useradd，那么就要将其复制到/mnt/sysroot/usr/sbin/目录中；
# 4、复制各库文件至/mnt/sysroot/对应的目录中；


#!/bin/bash
#
target=/mnt/sysroot/

[ -d $target ] || mkdir $target

preCommand() {
    if which $1 &> /dev/null; then
  commandPath=`which --skip-alias $1`
  return 0
    else
  echo "No such command."
  return 1
    fi
}

commandCopy() {
    commandDir=`dirname $1`
    [ -d ${target}${commandDir} ] || mkdir -p ${target}${commandDir}
    [ -f ${target}${commandPath} ] || cp $1 ${target}${commandDir}
}

libCopy() {
    for lib in `ldd $1 | egrep -o "/[^[:space:]]+"`; do
  libDir=`dirname $lib`
  [ -d ${target}${libDir} ] || mkdir -p ${target}${libDir}
  [ -f ${target}${lib} ] || cp $lib ${target}${libDir}
    done
}

read -p "Plz enter a command: " command

until [ "$command" == 'quit' ]; do

  if preCommand $command &> /dev/null; then
    commandCopy $commandPath
    libCopy $commandPath
  fi

  read -p "Plz enter a command: " command
done
```
