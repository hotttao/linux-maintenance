# 7.3 文件查找工具
本节我们学习文件查找工具，主要是两个命令的使用 `locate`，`find`。

## 1. locate
updatedb:
- 作用: 构建 locate 所需的数据库(耗费资源)

locate keyword
- 特点: 模糊查找

## 2. find
`find [OPTION]... [查找路径] [查找条件] [处理动作]``
- 查找路径: 指定具体目标路径，可多个路径，默认为当前目录
- 查找条件: 指定的查找标准，可以是文件名、大小、类型、权限等，默认为查找所有文件
- 处理动作: 对符合条件的文件做什么操作，默认输出至屏幕

#### 查找条件
- 文件名:
    - -name "文件名称"，支持使用通配符，仅仅匹配文件名称
    - -iname "文件名称"，忽略名称大小
    - -regex "pattern", 使用正则表达式，匹配整个路径文件路径，不仅仅是文件名称
- 根据属主，属组
    - -user username: 查找为指定用户的文件
    - -group groupname: 查找为指定属组的文件
    - -uid userid
    - -gid groupid
    - -nouser: 查找没有属主的文件
    - -nogroup: 查找没有属组的文件
    - eg:
        - find /tmp -user root -ls
- 根据文件类型查找
    - -type TYPE: 查找指定类型的文件
- 组合条件
    - -a : and
    - -o : or
    - -not | ！ : not
    - eg：
        - find /tmp \( -nouser -o -nogroup \) -ls
        - find /tmp -nouser -ls -o -nogoroup -ls
        - 附注: 处理动作仅限于位置相关的查找
        - find /tmp \( -not -user root -a -not -name "fstab" \) -ls
- 文件大小
    - -size [+|-]#UNIT:
        - UNIT: 查找单位，k，M，G
    - eg: find /var -size +3k -exec ls -h {} \
        - 3k: 表示范围为 (2k, 3k]
        - -3k: 表示范围为 [0, 2k]
        - +3k: 表示范围为 (3k, ∞)
- 根据时间戳
    - 以天为单位
        - -atime [+|-]#
        - -mtime
        - -ctime
        - eg: find /var -atime 3 -ls
            - 3: 表示[3, 4)
            - +3 表示[4, ∞)
            - -3 表示[0, 3）
    - 以分钟为单位
        - -amin
        - -mmin
        - -cmin
- 根据权限查找
    - -perm: [/|-]MODE
    - eg: find /var -perm 640 -ls
        - 640: 精确查找，0表示不考虑
        - /640: 任何一类对象(u,g,o)只要一位匹配即可，此处只要属主能读或者能写即可
        - -640: 每一类对象，同时拥有为其指定的权限，此处 740,660 权限均可

#### 处理动作
- print: 默认动作，显示至屏幕
- ls: 类似对查找的文件执行 ls -l 命令
- delete: 删除查到到的文件
- fls /path: 查找到的所有文件的长格式信息保存至指定文件中
- ok COMMAND {} \;
    - 对查找到的每个文件执行由 COMMAND指定的命令
    - 对每个文件执行命令之前，都会交互式确认
    - {}：表示find 传递的文件名本身
    - \;:固定格式符
- exec COMMAND {} \;:作用同 ok,但不会交互式确认
- find 传递查找到的文件的方式是
    - 一次查找到所有文件，并传递给 command，命令可能调用失败
    - find | xargs COMMAND
    - xargs: 一次传递一个参数
- eg:
    - find /tmp -nouser -exec chown root {} \;
    - **find /tmp -cmin -5 -exec mv {} {}.new \;**
        - {}：表示find 传递的文件名本身

## 3. 练习
```
# 查找/var/目录属主为root且属组为mail的所有文件；
> find /var -user root -a -group mail

# 查找/usr目录下不属于root、bin或hadoop的所用文件；
> find /usr -not -user root -a -not -user bin -a -not -user hadoop
> find /usr -not \(-user root -o -user bin -o -user hadoop\)

# 查找/etc/目录下最近一周内其内容修改过的，且不属于root且不属于hadoop的文件；
> find /etc -mtime -7 -a -not \(-user root -o -user hadoop\)

# 查找当前系统上没有属主或属组，且最近1个月内曾被访问过的文件；
> find / \(-nouser -o -nogroup\) -a -atime -30

# 查找/etc/目录下大于1M且类型为普通文件的所有文件；
> find /etc -size +1M -type f

# 查找/etc/目录所有用户都没有写权限的文件；
> find /etc/ -not -perm /222

# 查找/etc/目录下至少有一类用户没有写权限；
> find /etc/ -not -perm -222

# 查找/etc/init.d/目录下，所有用户都有执行权限且其它用户有写权限的文件；
> find /etc/init.d/ -perm -113
```
