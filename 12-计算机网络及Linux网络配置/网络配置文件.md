# 12.5 网络配置文件

## 3. 配置文件：
### 3.1 配置文件路径及格式
1. IP/NETMASK/GW/DNS等属性的配置文件：
- 路径: /etc/sysconfig/network-scripts/ifcfg-IFACE
2. 路由的相关配置文件：/
- 路径: etc/sysconfig/network-scripts/route-IFACE

#### ifcfg-IFACE 配置参数：
- DEVICE：此配置文件对应的设备的名称；
- HWADDR：设备的MAC地址；
- ONBOOT：在系统引导过程中，是否激活此接口；
- BOOTPROTO：激活此接口时使用什么协议来配置接口属性，常用的有dhcp、bootp、static、none；
- NM_CONTROLLED：是否使用NetworkManager服务来控制接口；Centos6 上建议为 no
- UUID：此设备的惟一标识；
- IPADDR： IP地址；
- NETMASK：子网掩码；CentOS 7支持使用PREFIX以长度方式指明子网掩码；
- GATEWAY：默认网关；
- DNS1：第一DNS服务器指向；
- DNS2：备用DNS服务器指向；
- IPV6INIT：是否初始化IPv6；
- TYPE：接口类型，常见的有Ethernet, Bridge；
- DOMAIN：DNS搜索域；
- USERCTL：是否允许普通用户控制此设备；
- PEERDNS：如果BOOTPROTO的值为“dhcp”，是否允许dhcp server分配的dns服务器指向覆盖本地手动指定的DNS服务器指向；默认为允许；
```
TYPE=Ethernet
BOOTPROTO=dhcp
DEFROUTE=yes
PEERDNS=yes
PEERROUTES=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=ens33
UUID=e1467f33-38fa-4718-84bd-02bd7f8ffa5f
DEVICE=ens33
ONBOOT=yes
```


#### route-IFACE 配置参数
支持两种配置方式，但不可混用；
- 每行一个路由条目：
- TARGET  via  GW
- 每三行一个路由条目：
- ADDRESS\#=TARGET
- NETMASK\#=MASK
- GATEWAY\#=NEXTHOP

#### 给网卡配置多个地址：
1. ip addr add  ip dev IFACE  label label_name
1. ifconfig  IFACE_LABEL  IPADDR/NETMASK
- IFACE_LABEL： eth0:0, eth0:1, ...
- eg: `ifconfig ens33:1 192.168.1.117/24 up`
2. 为别名添加配置文件；
- cp ifcfg-eth0 ifcfg-eth0:0
- 修改 ifcfg-eth0:0 配置
- DEVICE=IFACE_LABEL
- BOOTPROTO：网上别名不支持动态获取地址；static, none
- 删除 HWADDR，UUID

#### 网络接口识别并命名的 udev 配置文件
1. Centos6:
- /etc/udev/rules.d/70-persistent-ipoib.rules
- modprobe -r e1000: 卸载网卡驱动
- modprobe e1000: 装载网卡驱动，会重新读取 70-persistent-ipoib.rules 配置文件
2. Centos7: 由于网卡命名规则变化，所以 Centos6 的规则不适用

### 3.2 配置文件修改
1. 配置文件/etc/sysconfig/network-scripts/ifcfg-IFACE通过大量参数来定义接口的属性；其可通过vim等文本编辑器直接修改，
2. 也可以使用专用的命令的进行修改
- CentOS 6：system-config-network-tui / setup
- CentOS 7: nmtui

## 3.3 网络服务管理：
- network
- NetworkManager

管理网络服务：
- CentOS 6:
- service  SERVICE  {start|stop|restart|status}
- /etc/rc.d/init.d/network restart
- CentOS 7：systemctl  {start|stop|restart|status}  SERVICE[.service]

配置文件修改之后，如果要生效，需要重启网络服务；
- CentOS 6：service    network  restart
- CentOS 7：systemctl  restart  network.service
