# 12.1 计算机网络基础知识
本节先来简单说一说网络相关的基础知识。对于计算机网络我也不是很懂，如果有错误的地方希望指正。

计算机网络协议是一个网络协议栈，目的是将计算机主机之间通信这一复杂问题划分为多个层次，每个层次通过协议进行规范，向上层输出标准 api。一来通过分层降低解决问题的难度，二来特定层次可以有不同的实现，可以变动改进，只要遵守即定的协议，就不会影响到起他层次的使用，提供了最大程度的灵活性。我们学习网络知识，就是要学习计算机网络的层次，每个层次面对的问题，怎么解决问题，涉及到的协议和基础设施；最后对整个网络有个整体性的认识。本节将按照这样的顺序，对计算机网络做一个简述，包括:
1. 计算机网络的分层
2. 计算机网络协议栈

## 1. 计算机网络的分层
我们的数据都是以二进制的格式存放在磁盘上的，至于它是文本，还是视频取决于我们对数据的解析方式。因此我们在通过网络传输数据时，数据以二进制的形式进行传输，只是不同的传输介质表示二进制的方式不同。比如以太网使用高电压表示 1，低电压表示 0。最终数据传输完成后仍然需要按照特定的解析方式还原数据。

因此从宏观上来看，计算机网络被分成两个层次，通信子网和资源子网。通信子网关注的是如何传输数据，资源子网则只关心数据是如何组织起来的。因此整个过程有点类似于现实世界中寄快递，快递公司帮我们运输物品，我们不必关心快递公司是如何运输，但是我们必需确保我们物品没有损坏，也可以按需选择不同的快递公司。通过这样的分层我们将一个复杂问题分隔成一个个独立的子问题。

```
                --------------------
  用户空间  <--- |                   |  ---> 资源子网
                |-------------------|
  内核空间  <--- |                   |   ---> 通信子网
                |-------------------|
```

## 2. 计算机网络协议栈
![tcp_ip](../images/12/tcp_ip_iso.jpg)

计算机网络协议栈目前有两个标准:
1. TCP/IP 协议栈，这是当前事实上的使用标准，在实际生产环境中逐步演化而来，缺点是每个网络层次之间的接口定义并不是非常明确
2. OSI 协议栈，这是 ISO 组织对 TCP/IP 作出改进之后的版本，各个网络层次之间界限明确，但是各个层次之间功能有所重复，并没有TCP/IP效率高。正因为其定义规范且明确，这是一个我们更容易学习的版本

上图就是两个协议栈的对比示意图，每个层次的作用概述如下:
1. 物理层: 定义传输介质及介质之间的传输协议，比如电压等(网卡标准定义)
2. 数据链路层: 定义局域网内主机之间的通信，比如传输速度等
3. 网络层: 定义网络与网络之间的通信
4. 传输层: 定义进程与进程之间的通信
5. 应用层:
    - 会话层
    - 表示层
    - 应用层

接下来我们就来逐一了解各个网络层次。

### 2.1 物理层和数据链路层
设备：网桥或交换机  
寻址：MAC 地址  
问题：当网络中的计算机数量增加时，通信之间的相互干扰就会增大以至于，主机之间无法正常通信。此时我们需要将一个大网络划分成多个小网络，降低通信之间的干扰  

MAC：Media Access Control
  48bits：
    ICANN：24bits, 2^24
      地址块：2^24

    网桥（bridge）：MAC地址表
      静态指定：
      动态学习：根据原地址学习；

    交换机（switch）：多端口网桥；

### 2.2 网络层
设备：路由器  
寻址：IP 地址  

IP(Internet protocol)地址：网络号+主机号
    A<-->B
      网络？
      主机？

    IPv4：32bits
      8bits.8bits.8bits.8bits
        0-255
        0.0.0.0-255.255.255.255

        路由器：router
          路由表：
            静态指定
            动态学习：rip2, ospf

          路由条目：
            目标地址  下一跳(nexthop)
              目标地址的类别：
                主机：主机路由
                网络：网络路由
                0.0.0.0/0.0.0.0：默认路由							

### 2.3 传输层
寻址：IP 地址 + 端口


OS：多用户，多任务
  多任务：多进程
    chrome：
    QQ：
    QQ Music：

  通信时，进程的数字标识：
    16bits：
      0-65535：1-65535
        1-1023：固定分配，而且只有管理员有权限启用；
        1024-4W：半固定，
        4W+：临时；
  进程地址：
    IP:PORT,  socket

总结：
  MAC：本地通信；范围：本地局域网；
  IP：界定通信主机，源和目标；范围：互联网；
  Port：界定进程；范围：主机 ；
